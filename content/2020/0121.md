+++
date = '2020-01-21'
title = 'beancount'
tags = ['bookkeeping']
+++

ä¹‹å‰ï¼Œåªåœ¨æ¯æœˆåº•å¯¹æœˆå¼€é”€è¿›è¡Œä¸€æ¬¡æ±‡æ€»ã€‚
æœ€è¿‘ï¼Œè´¦ç›®å˜å¾—æœ‰ç‚¹å¤æ‚ï¼Œæ¯æœˆä¸€æ¬¡ä¸å¤ªå¤Ÿäº†ã€‚
æƒ³èµ·ä¹‹å‰çœ‹è¿‡çš„ beancountï¼Œé€‚ç”¨ä¹‹åæ„Ÿè§‰ç¡®å®ä¸é”™ã€‚

---

ä¸­æ–‡çš„å…¥é—¨ä»‹ç»ä¹Ÿå·²ç»æœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸é‡å¤äº†

- https://www.byvoid.com/blog/tag/Beancount
- https://blog.zsxsoft.com/post/41
- https://wzyboy.im/post/1317.html
- <https://t.me/beancount_zh>

---

beancount çš„ä¸€ä¸ªä¼˜åŠ¿ï¼Œæ˜¯å¯ä»¥åˆ’åˆ†è´¦æˆ·ï¼ŒåŒæ—¶å¯ä»¥å¯¹äº¤æ˜“æ‰“æ ‡ç­¾ã€‚
å…‰ fava çš„é»˜è®¤ç­›é€‰æ¡ä»¶ï¼Œå°±å·²ç»æ»¡è¶³äº†æˆ‘çš„æŠ¥è¡¨éœ€æ±‚ã€‚
æ›´å¼ºåŠ›çš„ SQL æŸ¥è¯¢ï¼Œç›®å‰éƒ½è¿˜æ²¡æ‰¾åˆ°ç”¨æ­¦ä¹‹åœ°ã€‚

è®°å½•ä¸ºçº¯æ–‡æœ¬ï¼Œé€‚åˆå„ç§æ–‡æœ¬ç¼–è¾‘å™¨æ“ä½œï¼Œå¯ä»¥é€šè¿‡ git è®°å½•ä¿®æ”¹ã€åŒæ­¥ã€‚
è¿™ç‚¹å¤§æ¦‚åªæœ‰ç¨‹åºå‘˜ä»¬æ¯”è¾ƒå–œæ¬¢ ğŸ˜‚ã€‚

å‰é¢çš„æ–‡ç« ï¼ŒåŒ…æ‹¬ tg è®¨è®ºç¾¤é‡Œï¼Œæœ‰æ·±åº¦ç”¨æˆ·ä»å„ç§æ¥æºå‘ beancount å¯¼å…¥è´¦å•ã€‚
æˆ‘æ˜¯è§‰å¾—å¤ªå¤æ‚äº†ï¼Œå¯¼å…¥è´¦å•çš„æ“ä½œè¿˜ä¸èƒ½å®Œå…¨è‡ªåŠ¨åŒ–ï¼ŒæŠ•å…¥äº§å‡ºæœ‰ç‚¹å¾—ä¸å¿å¤±â€¦â€¦
æ—¥å¸¸è®°å½•å¤§é¢æ”¶æ”¯ï¼Œå¹¶åœ¨æœˆåº•æ›´æ–°æœ¬æœˆå¼€é”€ï¼Œå°±å¯ä»¥æ»¡è¶³åŸºæœ¬çš„è®°è´¦éœ€æ±‚äº†ã€‚
æ›´è¯¦ç»†çš„å†…å®¹ï¼Œåƒä¿¡ç”¨å¡è´¦å•ã€æ”¯ä»˜å®è´¦å•ï¼Œä¹‹å‰ä¹Ÿä¸ä¼šå»ç•™æ„ï¼Œä¸ºäº† beancount è®°å½•å»èŠ±è¿™ä¸ªæ—¶é—´ï¼Œæœ‰ç‚¹æœ¬æœ«å€’ç½®ã€‚

ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œbeancount å¯ç©æ€§é«˜ï¼Œå¯ä»¥æ»¡è¶³å„ç±»äººç¾¤çš„éœ€æ±‚ã€‚
ç¡¬è¦è¯´ä¸è¶³ï¼Œç§»åŠ¨ç«¯ç¼ºå°‘å¥½ç”¨çš„å®¢æˆ·ç«¯å§ã€‚

---

æ›´æ–°ï¼š
beancount_zh ç¾¤é‡Œä¹Ÿæœ‰å…¶ä»–äººé‡åˆ°è®¡ç®—ç²¾åº¦çš„é—®é¢˜ï¼Œå…¶å®å®˜æ–¹æœ‰ç¯‡[æ–‡æ¡£](http://furius.ca/beancount/doc/tolerances)å°±æ˜¯è®²å¦‚ä½•å¤„ç†è¿™ä¸ªåœºæ™¯çš„ã€‚
æ–‡ç« è¯¦ç»†è§£é‡Šäº†è¯¯å·®æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œå¤ªé•¿ä¸çœ‹å°±è¯•è¯• `option "inferred_tolerance_default" "CNY:0.01"`ã€‚

ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘è¿˜æ˜¯æ²¡åˆ†æ¸…æ¥š cost å’Œ price çš„åŒºåˆ«â€¦â€¦

---

æ›´æ–°ï¼š

å­¦ä¼šäº† bean-priceï¼Œå¥½ç”¨ã€‚
`PYTHONPATH=$(pwd)/sources bean-price --no-cache --inactive commodity.bean >> prices.bean`
è‡ªå¸¦çš„ yahoo æºæœ‰è´§å¸å…‘æ¢å’Œè‚¡ç¥¨çš„æ•°æ®ï¼Œè‡ªå·±å†™äº†å‡ è¡Œä»£ç ä»è›‹å·æ‹¿åŸºé‡‘æ•°æ®ï¼Œå®Œäº‹ã€‚

```bash
$ cat commodity.bean

2020-01-01 commodity F_001051
    name: "åå¤ ä¸Šè¯50ETFè”æ¥A"
    price: "CNY:danjuan/001051"

2020-01-01 commodity S_510300
    name: "300ETF"
    price: "CNY:yahoo/510300.SS"

2020-01-01 commodity USD
    price: "CNY:yahoo/USDCNY=X"
```
