+++
date = '2020-03-31'
title = 'summary @ 2020-03'
tags = ['summary', 'faunadb', 'cloudflare worker', 'anime']
+++

- 编程
    - cwc，在看了。
    - tapl，在看了。重新看，不少细节已经忘了……
        - 感觉也就到此为止了……
    - cloudflare worker 的 debugger 支持太差。某处遗漏 await 的问题，各种打日志，排查了一天。
    - 折腾了一下 AWS 和 GCP，感觉都不太会用……要么完整的 VPS，要么 heroku 这类直接部署，都好用很多。
    - 搞懂了怎么使用 FaunaDB，可以当成 cloudflare worker KV 的替代品。体验比 firebase 好了不少。
    - FaunaDB 的 FQL 就是手写 AST，支持 lambda 所以表达能力完全足够。可以提前把操作封装成函数，客户端直接调用即可。
        - 一个 JSON HTTP 完事，完全不需要什么 SDK。
        - 变成写存储过程了？理论上完全可以提供 SQL 封装，为什么选择让用户手写查询过程呢？怎么做优化呢？
    - 借 FaunaDB 的机会，又试了下 GraphQL，还是不喜欢…
    - 又更新了一下 feedbox，小修小补……
        - 修复了一个 service worker 里重复请求的 BUG
        - 引入了之前写的 router，针对 worker 进行了改造。service worker 和 cloudflare worker 下都。
    - 前端的缓存越来越麻烦了
        - 分层越来越多
            - service worker 缓存，可以忽略 cache-control，完全自己控制。
            - 浏览器缓存，靠 cache-control 控制。
            - CDN 缓存，理论上也遵循 cache-control。
            - cloudflare worker 作为网关，也可以单独控制缓存。目前没搞清楚 cache API 怎么玩…
            - 服务端输出 cache-control。
        - 理论上，规则其实很简单。
            - 动态内容不缓存，或者走 304 的协商缓存。
            - js/css/font/image 之类的静态内容，全部打上版本号丢 CDN。配合超大的 max-age 甚至 immutable，走用户的浏览器缓存。
                - 比如 jsdelivr 输出的是 `cache-control: public, max-age=31536000, s-maxage=31536000, immutable`
            - 部分静态资源，不方便加版本号，可以走 304 的协商缓存。
                - 比如 index.html, favicon.ico, service-worker.js 等。
        - ~~问题在于分层太多，又不在同一处控制。需要把规则向各处同步，部署起来就比较烦了。~~
        - 把 feedbox 的请求路径梳理了一下。
            - 在 server 端设置好 cache-control。之后 cloudflare CDN 会遵循 cache-control，worker 不需要手动修改控制。
            - 请求先通过 cloudflare CDN，没有命中缓存才会进入 cf worker，之后 CDN 根据 worker 返回的 cache-control 进行缓存。如果服务端的 cache-control 符合预期，不需要在 worker 里调用 cache API。即使不符合预期，修改 cache-control 也更容易理解。
            - 浏览器的 service worker 属于锦上添花。在 feedbox 中收益主要是对 API 的缓存，能比 cache-control 做得更精细。
            - 总结一下，需要处理 server 和 service worker 两部分，也不麻烦。
    - 关于邮箱的二三事
        - 发现 free-for.dev 上没有 mailgun，才发现 mailgun 开始收费了……
        - 用了 improvmx 做转发，可以用 h11.io 的域名收邮件了。不过发邮件可能是个问题，没有 DKIM。
        - 期待 DHH 的 hey。
- 娱乐
    - 我的三体，感觉不错。
    - 映像研，最后一集看了一半，最后的动画都没心思看完。就像之前说的，不知哪里吸引力不足。整部动画，我个人最喜欢的是泼茶水的那部分。
    - ID:INVADED 也完结了。原创好像都解决不了高开低走的问题，为什么呢？井中井的部分是剧情最高潮吧，虽然类似桥段有点泛滥了，不过我的抵抗力一直不高。
    - 整个季度，最欢乐的异种族风俗娘吧。M·A·O 真萌。
    - 歌舞伎町夏洛克，一样是前面的单元剧比最后好看。
    - 因为电锯人的关系，去看了炎拳。
- 日常
    - 入手了一台打印机，HP M17a。mac 自带的 AirPrint 不能正常工作，得去 HP 官网下驱动。
    - 又把 dnsmasq-china-list, unbound 都搞了起来，网络问题糟心。
    - 北外的网课免费了，找了一些。有个课程在那，至少会带来三分钟的热度。
    - 看了下厚大法考的刑法视频，还挺有意思的。但要说有学到什么，就只是错觉吧。
- 投资
    - 嗯…会跌到哪天呢？
