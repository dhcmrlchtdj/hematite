<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width">
<title>javascript 获取页面高度</title>
<link rel="stylesheet" href="https://raw.github.com/necolas/normalize.css/master/normalize.css" />
<link rel="stylesheet" href="../../theme/static/css/common.css" />
</head>
<body>
<header>
<h1>涂鸦</h1>
</header>
<nav>
<ul>
<li><a href="../../index.html" title="index">INDEX</a></li>
<li><a href="../../category.html" title="category">CATEGORY</a></li>
<li><a href="../../tag.html" title="tag">TAG</a></li>
<li><a href="../../link.html" title="link">LINK</a></li>
<li><a href="../../about.html" title="about">ABOUT</a></li>
</ul>
</nav>
<article id="post">
<h1>js里的高度</h1>
<p>最近在写一个带iframe的静态页面，
要求根据iframe内容调整高度，也就是说自适应。</p>
<p>接着就对js绝望了，不仅仅是ie，每个浏览器都是按着自己的一套来解释。
可见合理使用jquery，yui等框架类库还是很有必要的，
浏览器的兼容性问题根本就是前端的地狱。</p>
<p>chrome还有个奇怪的bug，在本地打开静态页面，调试js的时候，
无法访问iframe的内容（同样在本地），说是跨域了。
怀疑是file://的问题，不支持这种协议么。
上网搜了下，有人在本地把服务器架起来，然后访问localhost，
chrome真是让人无语了。</p>
<hr />
<p>总结下关于js里面和宽度高度有关的属性。</p>
<p>一样先是参考资料</p>
<ul>
<li><a href="http://www.quirksmode.org/mobile/viewports.html">http://www.quirksmode.org/mobile/viewports.html</a></li>
<li><a href="http://www.quirksmode.org/dom/w3c_cssom.html">http://www.quirksmode.org/dom/w3c_cssom.html</a></li>
</ul>
<p>看完之后，整理出的就是这些下面这些内容了。</p>
<hr />
<div class="codehilite"><pre><span class="c1">// 1. window</span>

<span class="c1">// ie678 不支持 1.1 - 1.4</span>
<span class="c1">// opera 不支持 1.4</span>

<span class="c1">// 1.1 浏览器显示的页面大小（浏览器大小 减去 浏览器面板大小）</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span>

<span class="c1">// 1.2 浏览器大小</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">outerWidth</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">outerHeight</span>

<span class="c1">// 1.3 浏览器显示的页面 和 整个html页面 边界的距离</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">pageXOffset</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span>

<span class="c1">// 1.4 浏览器 相对 显示器 的距离</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">screenX</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">screenY</span>

<span class="c1">// 1.5 显示器的大小</span>
<span class="c1">// screen === window.screen</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">availWidth</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">availHeight</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">width</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">height</span>
</pre></div>


<p>感觉比较实用的只有<code>innerHeight</code>和<code>pageYOffset</code>。</p>
<div class="codehilite"><pre><span class="c1">// 2. element</span>
<span class="c1">// 几个相关属性，其中2.1 - 2.5都是只读属性</span>
<span class="c1">// 下面用e表示element</span>

<span class="c1">// 2.1 相对父元素（offsetParent）的位置</span>
<span class="c1">// ie67 下有问题</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">offsetTop</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">offsetLeft</span>

<span class="c1">// 2.2 元素的宽/高度</span>
<span class="c1">// 包括border在内，不含margin</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">offsetWidth</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">offsetHeight</span>

<span class="c1">// 2.3 元素的宽/高度</span>
<span class="c1">// 包括width和padding，不包括滚动条和border</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">clientWidth</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">clientHeight</span>

<span class="c1">// 2.4 border-top和border-left的大小</span>
<span class="c1">// 在文字是 右往左 的情况下，clientLeft会包括滚动条的宽度</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">clientTop</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">clientLeft</span>

<span class="c1">// 2.5 元素的实际大小</span>
<span class="c1">// 包括padding，无视boder，不含margin</span>
<span class="c1">// 在有即使有滚动条，也是返回元素的实际大小</span>
<span class="c1">// 没有滚动条就和clientWidth/clientHeight一样了</span>
<span class="c1">// ie67 和 opera10.6以下 可能有问题</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">scrollWidth</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">scrollHeight</span>

<span class="c1">// 2.6 元素可见部分 和 元素边界 的距离</span>
<span class="c1">// scrollTop = scrollHeight - clientHeight</span>
<span class="c1">// 没有滚动条时等于clientWidth/clientHeight</span>
<span class="c1">// 可以赋值，相当于移动滚动条了</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">scrollTop</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">scrollLeft</span>
</pre></div>


<p>上面一堆看着可能乱了点，要获取页面高度。
首先是获取2个元素<code>document.documentElement</code>和<code>document.body</code>，
前者表示整个html文档，后者是整个body元素。
要获取页面高度也就是获取这两者的高度了，而且是必须两个都获取。
因为不同浏览器在处理上有差异，
使用的时候最好在多个浏览器上进行测试。</p>
<p>下面是我自己这次写的自适应高度的代码</p>
<div class="codehilite"><pre><span class="kd">function</span> <span class="nx">setHeight</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;#iframe&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">iframe_doc</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">||</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">_height</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">iframe_doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">,</span>
        <span class="nx">iframe_doc</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">);</span>
    <span class="nx">iframe</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">_height</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>下面是获取鼠标点击位置，以后可能用的上吧。</p>
<div class="codehilite"><pre><span class="c1">// 3. mouse event</span>
<span class="c1">// 鼠标点击的位置</span>

<span class="c1">// 3.1 相对整个html</span>
<span class="c1">// ie不支持</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span>

<span class="c1">// 3.2 相对浏览器窗口</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span>

<span class="c1">// 3.3 相对显示器</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">screenX</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">screenY</span>

<span class="c1">// 3.4 相对元素本身</span>
<span class="c1">// 各个浏览器实现都不一样？</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">offsetX</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">offsetY</span>

<span class="c1">// 4</span>
<span class="c1">// 4.1 在页面内移动</span>
<span class="nx">x</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="nx">x</span><span class="p">.</span><span class="nx">scrollIntoView</span><span class="p">();</span>
</pre></div>


<hr />
<p>翻了下《professional javascript》，原来还和怪异模式（quirk mode）有关系。
书上的代码也简写了下，放下面了。用来获取浏览器窗口的高度。</p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">_height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">_height</span> <span class="o">!==</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span>
    <span class="nx">_height</span> <span class="o">=</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">compatMode</span> <span class="o">===</span> <span class="s1">&#39;CSS1Compat&#39;</span><span class="p">)</span> <span class="o">?</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientHeight</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
</pre></div>


<p>上面的代码本身不难，关键是知道
在标准模式下，<code>document.compatMode</code>的值为<code>CSS1Compat</code>。
在标准模式下，ie6通过<code>document.documentElement.clientHeight</code>获取页面高度。
在怪异模式下，ie6通过<code>document.body.clientHeight</code>获取页面高度。</p>
<p>所以说埋头看书根本写不出优秀的js代码，写js必须了解浏览器差异。
我感觉一个方法就是去看jquery，yui的实现，看他们是怎么处理浏览器差异的。
一开始先看yui吧，整体的结构更加清晰，不至于一下子就昏了头。</p>
</article>
</body>
</html>
