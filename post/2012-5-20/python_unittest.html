<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width">
<title>python 单元测试笔记（坑）</title>
<link rel="stylesheet" href="https://raw.github.com/necolas/normalize.css/master/normalize.css" />
<link rel="stylesheet" href="../../theme/static/css/common.css" />
</head>
<body>
<header>
<h1>涂鸦</h1>
</header>
<nav>
<ul>
<li><a href="../../index.html" title="index">INDEX</a></li>
<li><a href="../../tag.html" title="tag">TAG</a></li>
<li><a href="../../link.html" title="link">LINK</a></li>
<li><a href="../../about.html" title="about">ABOUT</a></li>
</ul>
</nav>
<article id="post">
<h1>python unittest</h1>
<p>程序员应该学会写测试代码，进行自动化测试。
网上可以找到一堆单元测试啊，测试驱动开发之类的东西，
可惜我一直不知道到底测试什么玩意儿。</p>
<p>直到我想写个markdown.py。</p>
<p>我脑袋里自然而然地冒出了写测试的想法。
先写测试代码，然后实现某个功能，下个测试，下个功能……
这个就是所谓的突然开窍了么。</p>
<hr />
<p>这篇文章的主要内容是unittest模块的学习笔记。
按计划是我自己写了测试代码，这个文章就更新相应的内容。</p>
<p>官方文档在</p>
<p><a href="http://docs.python.org/library/unittest.html">http://docs.python.org/library/unittest.html</a></p>
<hr />
<p>下面进入正题，先开始项目再说。</p>
<p>整个项目就2个文件，<code>markdown.py</code>和<code>markdown_test.py</code>。</p>
<div class="codehilite"><pre><span class="c"># markdown_test.py</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">markdown</span> <span class="kn">import</span> <span class="n">Markdown</span>

<span class="c"># 测试的类要继承unittest.TestCase</span>
<span class="k">class</span> <span class="nc">MarkdownTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="c"># 测试 是以&#39;test_&#39;开头的方法</span>
    <span class="k">def</span> <span class="nf">test_h1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;# h1&#39;</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">Markdown</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="c"># 这个很好理解吧，比较结果是否相等</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s">&#39;&lt;h1&gt;h1&lt;/h1&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># 执行上面的测试</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>执行<code>python markdown_test.py</code>就会输出测试结果。</p>
<p>顺便把<code>markdown.py</code>也贴出来看一下。</p>
<div class="codehilite"><pre><span class="c"># markdown.py</span>

<span class="k">class</span> <span class="nc">Markdown</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s">&#39;&lt;h1&gt;h1&lt;/h1&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">return</span> <span class="n">html</span>
</pre></div>


<p>细节就不要在意了。总之，整个项目开始起步了。
<code>assertEqual()</code>应该是最常用的测试了吧。</p>
<p>然后可以开始下个测试了（毫无疑问，失败了）。</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">test_h2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;## h2&#39;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">Markdown</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s">&#39;&lt;h2&gt;h2&lt;/h2&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>


<p>最后说两句， 刚开始，我也想按照markdown的语法把测试先写好，具体实现慢慢来。
可是想一想，在完成所有功能前，每次测试都是失败的，也太打击人了。
还是测试写一点，功能实现一点更能带来成就感吧。</p>
<p>这个想法倒也不是我自己拍脑袋想出来的，
以前翻过一本叫《测试驱动开发的艺术》，这种直接返回<code>'&lt;h1&gt;h1&lt;/h1&gt;\n'</code>
的做法就是这书上看来的。
看网上的豆瓣上评价还可以，我自己随便翻了点，可惜看不下去。
但这种作弊式的做法我倒是记下来了。</p>
<p>说到作弊，突然想到了插值逼近，基函数这种东西在我看来，
也是典型的作弊啊，居然还能把基函数算出来，这个可以说是数学之美么？</p>
</article>
</body>
</html>
