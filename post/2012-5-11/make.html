<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width">
<title>make 学习记录（坑）</title>
<link rel="stylesheet" href="../../theme/static/css/common.css" />
</head>
<body>
<header>
<h1>涂鸦</h1>
</header>
<nav>
<ul>
<li><a href="../../index.html" title="index">INDEX</a></li>
<li><a href="../../category.html" title="category">CATEGORY</a></li>
<li><a href="../../tag.html" title="tag">TAG</a></li>
<li><a href="../../link.html" title="link">LINK</a></li>
<li><a href="../../about.html" title="about">ABOUT</a></li>
</ul>
</nav>
<article id="post">
<h1>make</h1>

<p>准备使用make实现自动更新，下面是make的学习笔记。</p>

<hr />

<p>参考资料：</p>

<ul>
<li><a href="http://www.gnu.org/software/make/manual/">GUN make manual</a></li>
<li><p><a href="http://wiki.ubuntu.org.cn/跟我一起写Makefile">跟我一起写Makefile</a></p></li>
<li><p><a href="http://stackoverflow.com/questions/448910/makefile-variable-assignment">Makefile variable assignment</a></p></li>
</ul>

<p>我写makefile碰到什么，下面就记了什么。
需要完整学习make，自行翻阅参考资料。</p>

<hr />

<h2>变量</h2>

<p>先是调用，<code>$(name)</code>或者<code>${name}</code>，小括号或大括号里面就是变量名。</p>

<p>然后是赋值，四种。</p>

<ol>
<li><code>var = value</code></li>
<li><code>var := value</code></li>
<li><code>var ?= value</code></li>
<li><code>var += value</code></li>
</ol>

<p>变量的本质上类似c中的宏，是进行替换。
上面四种赋值方式区别在于，
第一种在<strong>调用时</strong>赋值；
第二种在<strong>申明时</strong>赋值；
第三种在<strong>调用时</strong>查看变量是否已赋值，对未赋值的变量进行赋值；
第四种就是在变量后追加一些值，赋值方式要看最初使用了<code>=</code>还是<code>:=</code>。</p>

<ul>
<li>变量名区分大小写。</li>
<li><code>$</code>用<code>$$</code>表示。</li>
<li>等号两边空格会被忽略。</li>
<li><code>+=</code>会自动加上空格。</li>
</ul>

<hr />

<h2>make命令</h2>

<p>以前碰到的就两个<code>make</code>和<code>make clean</code>。</p>

<p>输入<code>make</code>的时候，make就去找Makefile然后生成第一个目标（target）。
输入<code>make clean</code>的时候，make就去找Makefile里面的clean这个目标（target）。</p>

<p>定义target很简单</p>

<p><code>
target: prerequisites
    recipe
</code></p>

<p>target就是要生成的文件，
prerequisites是target依赖的文件，
recipe是要执行的shell命令。
每次prerequisites变化了，make都会重新执行recipe来生成新target。
recipe前面是<code>tab</code>不是空格，可以有多个recipe，换行或者;间隔。</p>

<p>像clean这样的是伪目标（phony target）是这样申明的</p>

<p><code>
.PHONY: clean
clean:
    recipe
</code></p>

<p>也就是说没有依赖文件，其他都是一样的。
然后就可以使用make clean调用这个伪目标。</p>

<p>recipe里面的命令要是失败了，整个target都会停下。
在recipe前面加个减号，也就是<code>[tab]-recipe</code>，
make就会忽略返回值，一条recipe失败了也会继续执行。
比如<code>rm *.html</code>这个命令在<code>index.html</code>不存在时会失败，
这个时候换成<code>-rm *.html</code>就可以了。</p>

<p><code>
    cd post
    -rm *.html
</code></p>

<p>上面这两个命令是不会删除<code>post/*.html</code>的，
要换成<code>cd post;-rm *.html</code>才可以。</p>

<hr />

</article>
</body>
</html>
