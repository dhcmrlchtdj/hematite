<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width">
<title>计时攻击</title>
<link rel="stylesheet" href="https://raw.github.com/necolas/normalize.css/master/normalize.css" />
<link rel="stylesheet" href="../../theme/static/css/common.css" />
<link rel="alternate" type="application/rss+xml" href="../../feed" title="Feed">
</head>
<body>
<header>
<h1>涂鸦</h1>
</header>
<nav>
<ul>
<li><a href="../../index.html" title="index">INDEX</a></li>
<li><a href="../../tag.html" title="tag">TAG</a></li>
<li><a href="../../link.html" title="link">LINK</a></li>
<li><a href="../../about.html" title="about">ABOUT</a></li>
</ul>
</nav>
<article id="post">
<h1>计时攻击</h1>
<p>找 bcrypt 的 python 库时，找到了<a href="https://github.com/mitsuhiko/python-pbkdf2">python-pbkdf2</a>，
准备使用时突然发现这是 python2 版的。理所当然准备移植到 python3。</p>
<p>看说明文档时，碰到了个问题。<code>safe_str_cmp</code>这个函数是干什么用的？
隐约有点印象，在 tornado 的代码有长相类似的函数，
好像在 v2ex 看人提过，还给了 stackoverflow 的链接。
可惜在 v2ex 和 stackoverflow 的相关链接都找不着了。</p>
<p>又搜了半天，终于把问题给理清楚了。</p>
<hr />
<p>上面都是废话……</p>
<p>放上几个链接：</p>
<ul>
<li><a href="https://github.com/PaulMcMillan/advanced_security_pycon_2012">Advanced Security Topics</a></li>
<li><a href="http://brianrue.wordpress.com/2012/03/09/pycon-2012-notes-advanced-security-topics/">PyCon 2012 Notes – Advanced Security Topics</a></li>
<li><a href="http://codahale.com/a-lesson-in-timing-attacks/">A Lesson In Timing Attacks</a></li>
<li><a href="https://github.com/facebook/tornado/blob/master/tornado/web.py#L2074">Tornado</a></li>
<li><a href="https://github.com/codahale/bcrypt-ruby/pull/43">Use constant-time string comparison algorithm</a></li>
</ul>
<p>第一个是 pycon2012 上的讲稿，提到了这个问题。
光看讲稿，说的不是很明白，英语好的同学看视频去吧。</p>
<p>第二个和第三个资料讲得挺清楚的。
简单来说，这个安全比较函数是用来比较加密后的字符串的。
直接使用原生的比较函数，也可以正确判断两字符串。问题在于，
不同的输入字符串需要的比较时间是不一样的。所以某些有心人可以靠这个时间差，
来判断密码。（时间越长，说明和密码越接近）。
这也就是为什么这种攻击被称为<em>计时攻击</em>（Timing attack）。</p>
<p>面对计时攻击的挑战，安全比较函数应运而生，这个函数特点在于比较时间是常量。
第四个链接是 tornado 中的实现，叫做<code>_time_independent_equals</code>。
看了才知道 python3 的标准库里也实现了个
常数时间的字符串比较函数（constant-time string comparison function）。</p>
<p>归结起来，也就是说：<strong>对加密字符串的比较，应该使用比较时间为常数的比较函数，
避免受到计时攻击。</strong></p>
<p>最后的一个链接是来自 bcrypt-ruby 的讨论。
我们有没有必要使用专门的比较函数来规避计时攻击？
结论是对于某些加密算法（比如 bcrypt）来说，
<strike>不需要（具体自己看链接吧）。</strike>
why risk it if I can easily avoid it。
还是乖乖用<code>hmac.compare_digest</code>来比较吧。（2013/01/17）</p>
<hr />
<p>这应该是对博客动刀前的最后一篇了吧……</p>
<p>移植 python-pbkdf2 去。</p>
</article>
<footer></footer>
</body>
</html>
