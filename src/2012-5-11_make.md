# make

一直在考虑整体文件结构还有怎么实现markdown到post的转化。
现在目录结构已经基本确定，剩下就是markdown的处理了。
考虑是先使用tornado的template，之后自己学着写一个简单的python template。
然后是markdown到html的转换，在想学着自己实现还是用现成的。
虽然说不要重复造轮子，但是既然是学习的过程，自己动下手应该也不错吧？
不然直接去用jekyll不是更好么？
还有个问题就是怎么更新post，偶然想起了make。
一直没好好了解过make，随便看了下，好像还挺符合我要求的。
而且又能学到新东西了么，总之决定好好学习下make，这里准备放笔记了。

------

先放参考资料。

+ [GUN make manual](http://www.gnu.org/software/make/manual/)
+ [跟我一起写Makefile](http://wiki.ubuntu.org.cn/跟我一起写Makefile)

我自己写的makefile里用到什么写什么。

------

## 变量

赋值`var = value`或者`var := value`。
调用`$(var)`或者`${var}`。

+ 变量名区分大小写。
+ 调用实际上类似于c的宏，也就是在替换。
+ 赋值时可以用其他变量赋值，比如`a = $(A)`。
- `=`右边的变量可以在文件任意位置定义。
- `:=`右边的变量必须在调用前定义。
- 可以嵌套赋值，比如`b = $($(A))`。
+ `$`用`$$`表示。

------

## make命令

以前碰到的就两个`make`和`make clean`。

输入`make`的时候，make就去找Makefile然后生成第一个目标（target）。
输入`make clean`的时候，make就去找Makefile里面的clean这个目标（target）。

定义target很简单

```
target: prerequisites
    recipe
```

target就是要生成的文件，
prerequisites是target依赖的文件，
recipe是要执行的shell命令。
每次prerequisites变化了，make都会重新执行recipe来生成新target。
recipe前面是`tab`不是空格，可以有多个recipe，换行或者;间隔。

像clean这样的是伪目标（phony target）是这样申明的


```
.PHONY: clean
clean:
    recipe
```

也就是说没有依赖文件，其他都是一样的。
然后就可以使用make clean调用这个伪目标。

recipe里面的命令要是失败了，整个target都会停下。
在recipe前面加个减号，也就是`[tab]-recipe`，
make就会忽略返回值，一条recipe失败了也会继续执行。
比如`rm *.html`这个命令在`index.html`不存在时会失败，
这个时候换成`-rm *.html`就可以了。

```
    cd post
    -rm *.html
```

上面这两个命令是不会删除`post/*.html`的，
要换成`cd post;-rm *.html`才可以。

------

